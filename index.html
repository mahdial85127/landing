<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>مشاوره روانشناسی تلفنی | انتخاب بهترین مشاور</title>
</head>
<body>
  <form id="quiz">
    <label>سن:
      <input type="radio" name="age" value="20-30" /> ۲۰ تا ۳۰
      <input type="radio" name="age" value="30-40" /> ۳۰ تا ۴۰
      <input type="radio" name="age" value="40+" /> بالای ۴۰
    </label>
    <br />
    <label>نیاز:
      <input type="radio" name="need" value="low" /> کم
      <input type="radio" name="need" value="medium" /> متوسط
      <input type="radio" name="need" value="high" /> زیاد
    </label>
    <br />
    <label>حوزه:
      <input type="radio" name="area" value="family" /> خانواده
      <input type="radio" name="area" value="anxiety" /> اضطراب
      <input type="radio" name="area" value="self" /> اعتماد به نفس
    </label>
    <br />
    <input type="tel" name="phone" placeholder="09..." />
    <button type="submit">ارسال</button>
  </form>

  <div id="thank-you" style="display:none; color:green;">✅ ثبت شد</div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyGakeUAOsxL-CaRalgJC9RYhrH3CcmfqrrN5MBaQMRSCaA-ilcy2z0YrImZzKif_nS/exec";

    document.getElementById('quiz').addEventListener('submit', function (e) {
      e.preventDefault();

      const age = document.querySelector('input[name="age"]:checked')?.value || '';
      const need = document.querySelector('input[name="need"]:checked')?.value || '';
      const area = document.querySelector('input[name="area"]:checked')?.value || '';
      const phone = document.querySelector('input[name="phone"]').value.trim();

      const urlParams = new URLSearchParams(window.location.search);
      const utm_source = urlParams.get('utm_source') || '';
      const utm_medium = urlParams.get('utm_medium') || '';
      const utm_campaign = urlParams.get('utm_campaign') || '';
      const utm_term = urlParams.get('utm_term') || '';

      const data =
        "phone=" + encodeURIComponent(phone) +
        "&age=" + encodeURIComponent(age) +
        "&need=" + encodeURIComponent(need) +
        "&area=" + encodeURIComponent(area) +
        "&utm_source=" + encodeURIComponent(utm_source) +
        "&utm_medium=" + encodeURIComponent(utm_medium) +
        "&utm_campaign=" + encodeURIComponent(utm_campaign) +
        "&utm_term=" + encodeURIComponent(utm_term);

      fetch(scriptURL, {
        method: 'POST',
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: data
      })
      .then(response => {
        if (response.ok) {
          document.getElementById("quiz").style.display = "none";
          document.getElementById("thank-you").style.display = "block";
        } else {
          alert("ارسال با خطا مواجه شد.");
        }
      })
      .catch(err => {
        alert("خطا در ارسال");
        console.error(err);
      });
    });
  </script>
</body>
</html>
